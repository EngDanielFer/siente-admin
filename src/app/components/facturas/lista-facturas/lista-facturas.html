<div class="container">

    <div *ngIf="loading" class="text-center my-4">
        <div class="spinner-border text-primary"></div>
    </div>

    <div *ngIf="!loading" class="d-flex justify-content-between my-3">
        <div>
            Mostrando {{ (paginaActual - 1) * itemsPorPagina + 1 }} -
            {{ calcularFin() }} de {{ facturas.length }}
        </div>
    </div>

    <table *ngIf="!loading" class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>Fecha</th>
                <th>Cliente</th>
                <th>Método</th>
                <th>Total</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let f of facturasPorPagina">
                <td>{{ f.id }}</td>
                <td>{{ f.fecha | date:'short' }}</td>
                <td>{{ f.nombreCliente }} {{ f.apellidoCliente }}</td>
                <td>{{ f.metodoPago }}</td>
                <td><strong>{{ f.valorTotal | currency:'COP' }}</strong></td>
                <td>
                    <button class="btn btn-sm btn-outline-primary" (click)="verDetalle(f.id)">
                        Ver detalle
                    </button>
                </td>
            </tr>
        </tbody>
    </table>

    <nav *ngIf="!loading">
        <ul class="pagination">
            <li class="page-item" [class.disabled]="paginaActual === 1">
                <a class="page-link" (click)="paginaAnterior()">Anterior</a>
            </li>
            <li class="page-item" *ngFor="let p of numPaginas" [class.active]="p === paginaActual">
                <a class="page-link" (click)="cambiarPagina(p)">{{ p }}</a>
            </li>
            <li class="page-item" [class.disabled]="paginaActual === paginasTotales">
                <a class="page-link" (click)="paginaSiguiente()">Siguiente</a>
            </li>
        </ul>
    </nav>

    <div class="modal fade show d-block" *ngIf="mostrarModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">

                <div class="modal-header">
                    <h5 class="modal-title">Factura #{{ facturaSeleccionada?.id }}</h5>
                    <button type="button" class="btn-close" (click)="cerrarModal()"></button>
                </div>

                <div class="modal-body" *ngIf="loadingDetalle">
                    <div class="text-center">
                        <div class="spinner-border text-primary"></div>
                    </div>
                </div>

                <div class="modal-body" *ngIf="!loadingDetalle && facturaSeleccionada">

                    <p><strong>Cliente:</strong>
                        {{ facturaSeleccionada.nombreCliente }}
                        {{ facturaSeleccionada.apellidoCliente }}
                    </p>

                    <p><strong>Dirección:</strong>
                        {{ facturaSeleccionada.direccionCliente }}
                    </p>

                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Producto</th>
                                <th>Cant.</th>
                                <th>Precio</th>
                                <th>Subtotal</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let d of facturaSeleccionada.detalle">
                                <td>{{ d.nombreProducto }}</td>
                                <td>{{ d.cantidadProducto }}</td>
                                <td>{{ d.precioUnitario | currency:'COP' }}</td>
                                <td>{{ d.subtotal | currency:'COP' }}</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="text-end">
                        <p>Subtotal: {{ facturaSeleccionada.valorPagado | currency:'COP' }}</p>
                        <p>Envío: {{ facturaSeleccionada.precioEnvio | currency:'COP' }}</p>
                        <h5>Total: {{ facturaSeleccionada.valorTotal | currency:'COP' }}</h5>
                    </div>

                </div>

            </div>
        </div>
    </div>
</div>