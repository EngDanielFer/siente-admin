<div class="container">

    <div *ngIf="loading" class="text-center my-4">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Cargando</span>
        </div>
    </div>

    <div *ngIf="!loading">
        <div class="d-flex justify-content-between align-items-center mt-3 mb-3">
            <div>
                Mostrando {{ (paginaActual - 1) * itemProductosPorPagina + 1 }} -
                {{ calcularFin() }}
                de {{ productos.length }} registros
            </div>

            <nav aria-label="Navegaci贸n">
                <ul class="pagination mb-0">
                    <li class="page-item" [class.disabled]="paginaActual === 1">
                        <a class="page-link" (click)="paginaAnterior();" style="cursor: pointer;">Anterior</a>
                    </li>

                    <li class="page-item" *ngFor="let pagina of numPaginas" [class.active]="pagina === paginaActual">
                        <a class="page-link" (click)="cambiarPagina(pagina)" style="cursor: pointer;">
                            {{ pagina }}
                        </a>
                    </li>

                    <li class="page-item" [class.disabled]="paginaActual === paginasTotales">
                        <a class="page-link" (click)="paginaSiguiente()" style="cursor: pointer;">Siguiente</a>
                    </li>
                </ul>
            </nav>
        </div>

        <div class="table-responsive">
            <table class="table table-striped table-hover align-middle">
                <thead>
                    <tr>
                        <th scope="col">Imagen</th>
                        <th scope="col">ID de producto</th>
                        <th scope="col">Nombre</th>
                        <th scope="col">Descripci贸n</th>
                        <th scope="col">Cantidad</th>
                        <th scope="col">Costo Producci贸n</th>
                        <th scope="col">Ganancias por mayor</th>
                        <th scope="col">Ganancias al detal</th>
                        <th scope="col">Precio por mayor</th>
                        <th scope="col">Precio al detal</th>
                        <th scope="col">Stock</th>
                        <th scope="col">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let prod of productosPorPagina">
                        <td>
                            <img [src]="getImageUrl(prod.imagen_producto)" alt="{{ prod.nombre_producto }}"
                                class="img-thumbnail" style="max-width: 100px; max-height: 100px; object-fit: cover;"
                                onerror="">
                        </td>
                        <td>{{ prod.id }}</td>
                        <td>{{ prod.nombre_producto }}</td>
                        <td>{{ prod.descripcion_producto }}</td>
                        <td>{{ prod.peso_producto }}</td>
                        <td>{{ prod.costo_produccion }}</td>
                        <td>{{ prod.ganancia_por_mayor }}</td>
                        <td>{{ prod.ganancia_detal }}</td>
                        <td>{{ prod.precio_por_mayor }}</td>
                        <td>{{ prod.precio_detal }}</td>
                        <td>{{ prod.stock_producto }}</td>
                        <td>
                            <button class="btn btn-primary btn-sm" (click)="editarProducto(prod.id!)">Actualizar</button>
                            <button class="btn btn-info btn-sm" (click)="verCostosFijos(prod.id!)">
                                Costos Fijos
                            </button>
                            <button class="btn btn-warning btn-sm" (click)="verInsumos(prod.id!)">
                                Insumos
                            </button>
                            <button class="btn btn-danger btn-sm" (click)="eliminarProducto(prod.id!)">Eliminar</button>
                        </td>
                    </tr>

                    <tr *ngIf="productosPorPagina.length === 0">
                        <td colspan="12" class="text-center py-5">
                            <p class="text-muted mt-3">No hay productos registrados</p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="d-flex justify-content-between align-items-center mt-3 mb-3">
            <div>
                Mostrando {{ (paginaActual - 1) * itemProductosPorPagina + 1 }} -
                {{ calcularFin() }}
                de {{ productos.length }} registros
            </div>

            <nav aria-label="Navegaci贸n">
                <ul class="pagination mb-0">
                    <li class="page-item" [class.disabled]="paginaActual === 1">
                        <a class="page-link" (click)="paginaAnterior();" style="cursor: pointer;">Anterior</a>
                    </li>

                    <li class="page-item" *ngFor="let pagina of numPaginas" [class.active]="pagina === paginaActual">
                        <a class="page-link" (click)="cambiarPagina(pagina)" style="cursor: pointer;">
                            {{ pagina }}
                        </a>
                    </li>

                    <li class="page-item" [class.disabled]="paginaActual === paginasTotales">
                        <a class="page-link" (click)="paginaSiguiente()" style="cursor: pointer;">Siguiente</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

</div>

<app-costos-fijos-productos *ngIf="mostrarCostosFijos" [productoId]="productoSelecId!" (cerrar)="cerrarModal()">
</app-costos-fijos-productos>

<app-insumos-productos *ngIf="mostrarInsumos" [productoId]="productoSelecId!" (cerrar)="cerrarModal()">
</app-insumos-productos>